<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="wcz"><meta name="copyright" content="wcz"><title>Welcome | bigDreamer</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '6.1.0'
} </script><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="bigDreamer" type="application/atom+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Qt5-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95-%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8"><span class="toc-number">1.</span> <span class="toc-text">Qt5  学习记录 设计一个文本编辑器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%EF%BC%8C%E7%95%8C%E9%9D%A2%E4%BB%8B%E7%BB%8D%EF%BC%9A"><span class="toc-number">1.1.</span> <span class="toc-text">功能，界面介绍：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E7%9A%84%E6%89%93%E5%BC%80%EF%BC%8C%E6%96%B0%E5%BB%BA%EF%BC%8C%E4%BF%9D%E5%AD%98"><span class="toc-number">1.2.</span> <span class="toc-text">文本的打开，新建，保存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%8A%9F%E8%83%BD%EF%BC%9A%E5%AD%97%E4%BD%93%E8%AE%BE%E7%BD%AE%EF%BC%8C%E9%A2%9C%E8%89%B2%E4%BF%AE%E6%94%B9%E7%AD%89"><span class="toc-number">1.3.</span> <span class="toc-text">其他功能：字体设置，颜色修改等</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">wcz</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">2</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">bigDreamer</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right"></span></div><div id="post-info"><div id="post-title">No title</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-04-22</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="Qt5-学习记录-设计一个文本编辑器"><a href="#Qt5-学习记录-设计一个文本编辑器" class="headerlink" title="Qt5  学习记录 设计一个文本编辑器"></a>Qt5  学习记录 设计一个文本编辑器</h2><ul>
<li>刚开始学习qt，记录一下嘿嘿。欢迎各位大佬指出我的错误！</li>
</ul>
<h3 id="功能，界面介绍："><a href="#功能，界面介绍：" class="headerlink" title="功能，界面介绍："></a>功能，界面介绍：</h3><ul>
<li><strong>主窗口(QMainWindow)</strong></li>
<li><img src="https://picgo-images-1254437401.cos.ap-hongkong.myqcloud.com/QQ%E6%88%AA%E5%9B%BE20220421224521.png"></li>
<li>最上方：menuBar， 属于QMenuBar类。文件(QAction类） 包括打开文件，保存文件，新建等功能。 帮助 包含 “作者” Action，点击打开网页。编辑(QAction) 包括设置字体加粗，倾斜，查找与替换等功能。 中间toolbar，工具栏。其中 “选择颜色” PushButton，QFontComboBox等可以通过addWidget() 添加 ,实现字体颜色修改，字体大小设置，字体设置的操作。TextEdit类居中布局，使用setCentralWidget(QWidget * )；</li>
<li>最下方左下角显示打开的文件名。如果没有保存则不显示。以及显示光标的行列。</li>
<li>子窗口：(QWidget) ：负责接收输入的查找或替换内容，返回给在Mainwindow中定义的槽函数:<ul>
<li><img src="https://picgo-images-1254437401.cos.ap-hongkong.myqcloud.com/subform.png"></li>
</ul>
</li>
</ul>
<h3 id="文本的打开，新建，保存"><a href="#文本的打开，新建，保存" class="headerlink" title="文本的打开，新建，保存"></a>文本的打开，新建，保存</h3><ul>
<li><p>文件打开槽函数 ：</p>
<ul>
<li>&#96;&#96;&#96;c++<br>#include <QFileDialog>  &#x2F;&#x2F;QFileDialog类提供原型<br>void MainWindow::on_actOpen_triggered()<br>{<br>QByteArray stringOpen;<br>QString fileName; &#x2F;&#x2F;储存文件名，会显示在左下角。在最后赋值给ui-&gt;fLabFile<br>QString path &#x3D; QFileDialog::getOpenFileName(this,”打开文件”,”..&#x2F;“,”Text files (*.txt)”);<br>if(!path.isEmpty())<br>{<br>    QFile openfile(path);  &#x2F;&#x2F;打开文件<br>    bool openflag &#x3D; openfile.open(QIODevice::ReadOnly);  &#x2F;&#x2F;设置为只读方式打开<br>    if(openflag){<br>        text_save.clear();<br>        stringOpen &#x3D; openfile.readAll();<br>        text_save &#x3D; QString(stringOpen);  &#x2F;&#x2F;读取的为QByteArray，字符数组，转换为QString<br>        ui-&gt;MainText-&gt;setPlainText(text_save);<br>        &#x2F;&#x2F;文件打开后，把左下角当前文件改成打开的文件名。<br>       for(auto i &#x3D; path.size()-1 ;i &gt; 0;i–){<br>           fileName &#x3D; path.at(i) + fileName;  &#x2F;&#x2F;at返回第i个字符的引用。<br>           if(path.at(i-1) &#x3D;&#x3D; ‘&#x2F;‘){  &#x2F;&#x2F;如 D:&#x2F;Qt&#x2F;123.txt  获取 123.txt 文件名及后缀名。<br>               &#x2F;&#x2F;遇到 第一个 &#x2F;，退出循环。<br>               break;<br>           }<br>       }<br>       fLabFile-&gt;setText(“当前打开文件:” + fileName);<br>    }<br>    openfile.close();<br>}<br>}<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    + QFileDialog类 一些静态成员函数的用法(来自Qt 文档）：</span><br><span class="line"></span><br><span class="line">      | **[getOpenFileNames](https://doc.qt.io/qt-5/qfiledialog.html#getOpenFileNames)**(QWidget **parent* = nullptr, const QString &amp;*caption* = QString(), const QString &amp;*dir* = QString(), const QString &amp;*filter* = QString(), QString **selectedFilter* = nullptr, QFileDialog::Options *options* = Options()) | 第一个参数为父窗口指针默认0，第二个参数是打开的窗口标题。第三个是打开的目录位置。第四个参数为筛选器。如：(Text files (*.txt))。selectFilter 参数可以选择能够显示在对话框中的文件。下同。 | 在windows，mac平台上提供的是本地的对话框。如果是创建QFileDialog的指针来显示，提供的是Qt绘制的对话框。 |</span><br><span class="line">      | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |</span><br><span class="line">      | **[getOpenFileNames](https://doc.qt.io/qt-5/qfiledialog.html#getOpenFileNames)**(QWidget **parent* = nullptr, const QString &amp;*caption* = QString(), const QString &amp;*dir* = QString(), const QString &amp;*filter* = QString(), QString **selectedFilter* = nullptr, QFileDialog::Options *options* = Options()) | 参数跟第一个相同。返回的是多个文件的filename。QString类型    | 储存在一个QstringList中。可以看成是一个储存QString的list。   |</span><br><span class="line">      | **[getExistingDirectory](https://doc.qt.io/qt-5/qfiledialog.html#getExistingDirectory)**(QWidget **parent* = nullptr, const QString &amp;*caption* = QString(), const QString &amp;*dir* = QString(), QFileDialog::Options *options* = ShowDirsOnly) | 返回一个文件夹的位置。QString类型                            | 用于选取一个文件夹。                                         |</span><br><span class="line">      | **[getSaveFileName](https://doc.qt.io/qt-5/qfiledialog.html#getSaveFileName)**(QWidget **parent* = nullptr, const QString &amp;*caption* = QString(), const QString &amp;*dir* = QString(), const QString &amp;*filter* = QString(), QString **selectedFilter* = nullptr, QFileDialog::Options *options* = Options()) | 返回Qstring类型，储存保存文件的路径。参数跟前两个相同。      |                                                              |</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line"></span><br><span class="line">+ 文本保存槽函数(在mainwindow.h定义一个Qstring 类的对象 为 **text_save**，储存文本内容 )：</span><br><span class="line"></span><br><span class="line">  ```c++</span><br><span class="line">  //文本保存</span><br><span class="line">  void MainWindow::on_actSave_triggered()</span><br><span class="line">  &#123;</span><br><span class="line">      text_save = ui-&gt;MainText-&gt;toPlainText(); //toPlainText获取文本框的内容。</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>文件导出槽函数（保存为*.txt) </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actOutput_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//getSaveFileName 函数 参数说明： 父窗口指针。窗口标题。打开的路径。文件过滤器。</span></span><br><span class="line">    QString path = QFileDialog::<span class="built_in">getSaveFileName</span>(<span class="keyword">this</span>,<span class="string">&quot;保存文件&quot;</span>,<span class="string">&quot;../&quot;</span>,<span class="string">&quot;Text files (*.txt)&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!path.<span class="built_in">isEmpty</span>())&#123;</span><br><span class="line">        <span class="function">QFile <span class="title">outputfile</span><span class="params">(path)</span></span>; <span class="comment">//传递保存的路径。</span></span><br><span class="line">        <span class="type">bool</span> outOk = outputfile.<span class="built_in">open</span>(QIODevice::WriteOnly);  <span class="comment">//以只写的方式打开。打开结果返回给outOk</span></span><br><span class="line">        <span class="keyword">if</span>(outOk)&#123;</span><br><span class="line">            outputfile.<span class="built_in">write</span>(text_save.<span class="built_in">toUtf8</span>());  <span class="comment">//函数参数为bytearray。</span></span><br><span class="line">        &#125;</span><br><span class="line">        outputfile.<span class="built_in">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>QFile 类 的一些用法;</p>
<ul>
<li>首先<code> #include&lt;QFile&gt;</code></li>
<li>QFile对象构造函数 ：QFile(QString &amp; Name);  &#x2F;&#x2F;Name 为文件的路径。</li>
</ul>
<table>
<thead>
<tr>
<th>bool QDevice::open(OpenMode);</th>
<th>打开一个文件。打开成功返回true，否则false。打开模式有ReadOnly ,WriteOnly,Append(追加)，ReadWrite(既可以读也可以写)等。属于QIODevice类。</th>
</tr>
</thead>
<tbody><tr>
<td>QByteArray QIODevice::readAll();</td>
<td>读取文本的全部内容。也可以用read(qint64 maxsize) 指定读取的最大字节数。</td>
</tr>
<tr>
<td>qint64 QIODevice::write(const char * )  &#x2F;write(QByteArray &amp; ) &#x2F; write( const char *  ,qint64  maxsize)</td>
<td>把数据(const char * 或是QByteArray) 写入到文件。返回写入的字节数。</td>
</tr>
<tr>
<td>qint64 QIODevice::readLine(char *data, qint64 maxSize)</td>
<td>从文件中读取一行。或是最多maxsize个字节。返回实际读取的字符数。</td>
</tr>
<tr>
<td>close</td>
<td>关闭文件。 记得写！</td>
</tr>
</tbody></table>
</li>
<li><p>文件新建功能： </p>
<ul>
<li><p>即调用QString类的clear方法。并清空fLabFile标签显示的文本内容。</p>
</li>
<li><pre><code class="c++">void MainWindow::on_actNew_triggered()
&#123;
    text_save.clear();
    fLabFile-&gt;setText(&quot;当前打开文件:&quot;);
&#125;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 查找与替换功能（子窗口）</span><br><span class="line"></span><br><span class="line">+ 子窗口显示</span><br><span class="line"></span><br><span class="line">  + 首先创建一个窗口，这里选择继承自QWidget</span><br><span class="line"></span><br><span class="line">  + ![](https://picgo-images-1254437401.cos.ap-hongkong.myqcloud.com/newsubform.png)</span><br><span class="line"></span><br><span class="line">  + 在类的头文件中（这里是newui_searchandchange.h)写上Q_OBJECT，这样该对象**才有信号与槽功能**</span><br><span class="line"></span><br><span class="line">  + 在design界面添加两个lineEdit和两个pushButton，命名按钮为查找和替换。添加两个槽函数如下：</span><br><span class="line"></span><br><span class="line">    ```c++</span><br><span class="line">    void newUI_searchAndChange::on_pushButton_clicked()</span><br><span class="line">    &#123;</span><br><span class="line">        //发送LineText中的字符串。 发送信号SendString.</span><br><span class="line">        QString s = ui-&gt;lineEdit-&gt;text();</span><br><span class="line">        emit SendString(s);  //emit表明发送一个信号。SendString要在头文件的类的定义中添加。不必有实现。</span><br><span class="line">        this-&gt;hide();</span><br><span class="line">        //按下查找，发送查找lineEdit中的字符串。</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    void newUI_searchAndChange::on_pushButton_2_clicked()</span><br><span class="line">    &#123;</span><br><span class="line">        //替换发送信号。要求查找框和替换框都有内容，</span><br><span class="line">        QString search = ui-&gt;lineEdit-&gt;text();</span><br><span class="line">        QString change = ui-&gt;lineEdit_2-&gt;text();</span><br><span class="line">        if(search.isEmpty() || change.isEmpty())&#123;</span><br><span class="line">            QMessageBox::information(this,&quot;错误&quot;,&quot;需要输入查找的内容和替换的文本&quot;,QMessageBox::Ok);</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            emit Send2Strings(search,change);</span><br><span class="line">            this-&gt;hide();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p>头文件中:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">SendString</span><span class="params">(QString)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Send2Strings</span><span class="params">(QString,QString)</span></span>; <span class="comment">//发送查找和发送替换的两个函数。注意要写signals。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_pushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_pushButton_2_clicked</span><span class="params">()</span></span>;    </span><br><span class="line">...  </span><br></pre></td></tr></table></figure>
</li>
<li><p>同时，要在主窗口显示该窗口，在MainWindow.h 类的定义中添加一个newui_searchandchange 类的指针。在主窗口要打开该子窗口时，用new 赋值给该指针。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	newUI_searchAndChange * newui;</span><br></pre></td></tr></table></figure>


</li>
<li><p>主窗口中查找，替换的两个槽函数：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//主窗口中查找Action的槽函数。打开查找窗口。</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actFind_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!newui)&#123;</span><br><span class="line">        <span class="comment">//防止打开多个窗口。如果newui为空，表示窗体未创建。</span></span><br><span class="line">        <span class="comment">//打开查找子窗口</span></span><br><span class="line">        newui = <span class="keyword">new</span> <span class="built_in">newUI_searchAndChange</span>();</span><br><span class="line">        QObject::<span class="built_in">connect</span>(newui,<span class="built_in">SIGNAL</span>(<span class="built_in">SendString</span>(QString)),<span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">receiveData</span>(QString)));</span><br><span class="line">        <span class="comment">//注意信号的函数只需写函数名。（会加上newui对应的类和:: ）槽函数同理。</span></span><br><span class="line">        newui-&gt;<span class="built_in">show</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        newui-&gt;<span class="built_in">show</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//主窗口中的槽函数 ，接收子窗口SendString信号 传来的target。 - _ -</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::receiveData</span><span class="params">(QString target)</span></span>&#123;</span><br><span class="line">    <span class="comment">//在MainText中查找到需要的字符串后跳转到该处</span></span><br><span class="line">    <span class="built_in">StringSearch</span>(target);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//用于MainText中 实现字符串查找功能。</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">MainWindow::StringSearch</span><span class="params">(QString  target)</span></span>&#123;</span><br><span class="line">    QTextCursor cur;</span><br><span class="line">    cur = ui-&gt;MainText-&gt;<span class="built_in">textCursor</span>();  <span class="comment">//获取文本光标位置。</span></span><br><span class="line">    cur.<span class="built_in">movePosition</span>(QTextCursor::Start); <span class="comment">//每次从头开始，往后查找。没有这句从后往前了。</span></span><br><span class="line">    ui-&gt;MainText-&gt;<span class="built_in">setTextCursor</span>(cur);</span><br><span class="line">      <span class="type">bool</span> flag = ui-&gt;MainText-&gt;<span class="built_in">find</span>(target);</span><br><span class="line">       <span class="keyword">if</span>(!flag)&#123;</span><br><span class="line">          QMessageBox::<span class="built_in">information</span>(<span class="keyword">this</span>,<span class="string">&quot;注意&quot;</span>,<span class="string">&quot;没有找到内容！&quot;</span>,QMessageBox::Ok);</span><br><span class="line">          <span class="comment">//没有找到用QMessageBox发送提示。</span></span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//主窗口中打开 替换 的槽函数。接收子窗口Send2Strings信号，如果connect 要放在MainWindow构造函数里。先为newui</span></span><br><span class="line"><span class="comment">//分配空间！ （找了好久的BUG md...）</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actChange_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!newui)&#123; <span class="comment">//防止重复打开。</span></span><br><span class="line">        <span class="comment">//打开子窗口</span></span><br><span class="line">        newui = <span class="keyword">new</span> newUI_searchAndChange;</span><br><span class="line">        			QObject::<span class="built_in">connect</span>(newui,<span class="built_in">SIGNAL</span>(<span class="built_in">Send2Strings</span>(QString,QString)),<span class="keyword">this</span>,<span class="built_in">SLOT</span>(<span class="built_in">StringChanged</span>(QString,QString)));</span><br><span class="line">        newui-&gt;<span class="built_in">show</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//注意信号的函数只需写函数名。（会加上newui对应的类和:: ）槽函数同理。</span></span><br><span class="line">    <span class="keyword">else</span>&#123;newui-&gt;<span class="built_in">show</span>();&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//字符串替换</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::StringChanged</span><span class="params">(QString target,QString s)</span></span>&#123;</span><br><span class="line">    QString str_save = ui-&gt;MainText-&gt;<span class="built_in">toPlainText</span>();</span><br><span class="line">    str_save.<span class="built_in">replace</span>(target,s);  <span class="comment">//replace函数会查找str_save中所有和target匹配的并替换。</span></span><br><span class="line">    ui-&gt;MainText-&gt;<span class="built_in">setText</span>(str_save);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>防止子窗口重复打开，除了在槽函数中判断!newui ，如果true就分配空间，否则执行显示。也可以设置窗口显示为模态Modality ，窗口不能被切换，不允许去操控其他窗口，除非被关闭  newui-&gt;setWindowModal(bool)。</strong></li>
</ul>
</li>
</ul>
<h3 id="其他功能：字体设置，颜色修改等"><a href="#其他功能：字体设置，颜色修改等" class="headerlink" title="其他功能：字体设置，颜色修改等"></a>其他功能：字体设置，颜色修改等</h3><ul>
<li><p>放在MainWindow构造函数中的一些设置：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">        ...</span><br><span class="line">    <span class="built_in">setWindowTitle</span>(<span class="string">&quot;Simple Text Editor&quot;</span>); <span class="comment">//窗口标题设置</span></span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">setMinimumSize</span>(<span class="number">1000</span>,<span class="number">800</span>); <span class="comment">//设置界面最小尺寸</span></span><br><span class="line">    QObject::<span class="built_in">connect</span>(FontSizeSelecter,<span class="built_in">SIGNAL</span>(<span class="built_in">currentIndexChanged</span>(<span class="type">int</span>)),<span class="keyword">this</span>,<span class="built_in">SLOT</span>(<span class="built_in">on_FontSizeSelecter_IndexChanged</span>()));</span><br><span class="line">        QObject::<span class="built_in">connect</span>(QFCB1,<span class="built_in">SIGNAL</span>(<span class="built_in">currentIndexChanged</span>(<span class="type">int</span>)),<span class="keyword">this</span>,<span class="built_in">SLOT</span>(<span class="built_in">on_FontComboBox_changed</span>()));</span><br><span class="line">        QObject::<span class="built_in">connect</span>(Q_color_btn,<span class="built_in">SIGNAL</span>(<span class="built_in">clicked</span>()),<span class="keyword">this</span>,<span class="built_in">SLOT</span>(<span class="built_in">on_colorBtn_clicked</span>()));</span><br><span class="line">    <span class="comment">//一些槽函数和信号的连接，即实现以下几个功能</span></span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>字体设置 (QFontComboBox):</p>
<ul>
<li><p>在主窗口头文件定义一个QFontComboBox类的指针。在cpp文件中定义一个函数，写：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::uiInit</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ... <span class="comment">//其他功能</span></span><br><span class="line"><span class="comment">//QFCB1 字体选择</span></span><br><span class="line">    QFCB1 = <span class="keyword">new</span> QFontComboBox;</span><br><span class="line">    ui-&gt;toolBar-&gt;<span class="built_in">addWidget</span>(<span class="keyword">new</span> <span class="built_in">QLabel</span>(<span class="string">&quot;字体选择: &quot;</span>));</span><br><span class="line">    ui-&gt;toolBar-&gt;<span class="built_in">addWidget</span>(QFCB1); <span class="comment">//添加到工具栏中。</span></span><br><span class="line">	...<span class="comment">//其他功能</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>字体设置的实现：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_FontComboBox_changed</span><span class="params">()</span></span>&#123;</span><br><span class="line">    QFont cur_font = QFCB1-&gt;<span class="built_in">currentFont</span>();</span><br><span class="line">    <span class="comment">//把FontComboBox选中的字体储存在QFont 类的cur_font 对象中，</span></span><br><span class="line">    <span class="comment">//调用MainText的setFont方法。设置字体</span></span><br><span class="line">    ui-&gt;MainText-&gt;<span class="built_in">setFont</span>(cur_font);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>字体颜色设置(QColorDialog)</p>
<ul>
<li><pre><code class="c++">//颜色的修改
void MainWindow::on_colorBtn_clicked()&#123;
    QColor colorTable = QColorDialog::getColor(Qt::white,this);
    if(colorTable.isValid())&#123;
        ui-&gt;MainText-&gt;setTextColor(colorTable); //修改文本框中选中内容的颜色。
    &#125;
&#125;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  + QColorDialog跳出一个颜色选择的对话框。getcolor返回用户选择的颜色。第一个参数为初始化的颜色 ： Qcolor &amp; initial = Qt::white, 第二个参数为父窗口指针，默认nullptr。</span><br><span class="line"></span><br><span class="line">+ 字体大小设置：</span><br><span class="line"></span><br><span class="line">  + 首先在头文件中添加一个combobox的指针。在跟字体设置同一个初始化函数中，将可选择的字号，添加(addItem)到combobox列表。</span><br><span class="line"></span><br><span class="line">  + ```c++</span><br><span class="line">    void MainWindow::uiInit()&#123;</span><br><span class="line">        ...</span><br><span class="line">    FontSizeSelecter = new QComboBox;</span><br><span class="line">        //初始化ComboBox 列表</span><br><span class="line">        for(int i = 5;i&lt;=50;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            FontSizeSelecter-&gt;addItem(QString::asprintf(&quot;%d&quot;,i));</span><br><span class="line">        &#125;</span><br><span class="line">        ui-&gt;toolBar-&gt;addWidget(FontSizeSelecter);</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p>&#96;&#96;&#96;c++<br>&#x2F;&#x2F;字体大小修改 ，跟索引改变信号连接。<br>void MainWindow::on_FontSizeSelecter_IndexChanged(){<br>int index &#x3D; FontSizeSelecter-&gt;currentIndex(); &#x2F;&#x2F;获取当前的索引。<br>ui-&gt;MainText-&gt;setFontPointSize(index + 5); &#x2F;&#x2F;储存时下标为0的对应大小为5.<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">+ 左下角行列的显示(QTextCursor):</span><br><span class="line"></span><br><span class="line">  + ```c++</span><br><span class="line">    //行列的显示</span><br><span class="line">    void MainWindow::on_MainText_cursorPositionChanged()</span><br><span class="line">    &#123;</span><br><span class="line">        int row;</span><br><span class="line">        int col;</span><br><span class="line">        QTextCursor cur;</span><br><span class="line">        QString  display_pos;</span><br><span class="line">        cur = ui-&gt;MainText-&gt;textCursor(); //用textcursor获取文本中光标的位置。</span><br><span class="line">        row = cur.blockNumber();</span><br><span class="line">        col = cur.columnNumber();</span><br><span class="line">        fLabFile2-&gt;setText(display_pos.asprintf(&quot;第 %d 行 ,第 %d 列 &quot;,row+1,col+1));</span><br><span class="line">        //asprintf()函数介绍： 跟sprintf类似，按照格式将第二个参数开始转换为字符串。</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>字体加粗&#x2F;下划线等：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">QTextCharFormat fmt;</span><br><span class="line"><span class="keyword">if</span>(checked)</span><br><span class="line">fmt.<span class="built_in">setFontUnderline</span>(checked);</span><br><span class="line"><span class="comment">//设置下划线。checked为信号triggered(checked)</span></span><br><span class="line"><span class="comment">//设置加粗可以用：</span></span><br><span class="line"><span class="built_in">setFontWeight</span>(QFont::Bold);</span><br><span class="line"><span class="comment">//设置斜体可以用setFontItalic(checked);</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><em>先写到这里！</em></p>
</li>
</ul>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">wcz</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2022/04/22/Qt5 入门_1设计一个文本编辑器/">http://example.com/2022/04/22/Qt5 入门_1设计一个文本编辑器/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="next-post pull-right"><a href="/2022/04/18/MyFirst-Blog/"><span>MyFirst_Blog</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2022 By wcz</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>